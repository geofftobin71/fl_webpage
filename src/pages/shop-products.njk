---
layout: layouts/shop-page.njk
pagination:
  data: valid_shop_products
  size: 1
  alias: product
permalink: "shop/products/{{ product.name | slug }}/index.php"
eleventyComputed:
  title: "{{ product.name }}"
  description: "{{ product.description }}"
  header_image: "{{ product.images[0] }}"
  header:
    brightness: "{{ product.brightness }}"
---

{% set product_images_count = product.images | length %}
{% set anim_fade_time = 1 %}
{% set anim_show_time = 4 %}
{% set anim_duration = (anim_fade_time + anim_show_time) * product_images_count %}
{% set one_second = 100.0 / anim_duration %}
{{ ( '<style>@keyframes ' + (product.name | slug) + '-fade{0%{opacity:0;}' + (anim_fade_time * one_second) + '%{opacity:1;}' + ((anim_fade_time + anim_show_time) * one_second) + '%{opacity:1;}' + ((anim_fade_time + anim_show_time + anim_fade_time) * one_second) + '%{opacity:0;}100%{opacity:0;}}</style>' ) | safe if product_images_count > 1 }}
{% set image_id = (product.images | first | stripVersion) or (site.header_image | stripVersion) %}
{% set lqip_path = site.cloudinary_url + "/c_limit,w_32,h_32,q_auto,f_jpg,e_blur:100/" + image_id %}
{% set lqip_data = lqip_path | imgLqip %}

<style>
.fader img {
  opacity: 0;
  animation-iteration-count: infinite;
}
.radio-label-wrapper {
  display:flex;
  flex-wrap:wrap;
  flex-direction:row;
  justify-content:center;
  margin: -4px;
}
.radio-label {
  font-family: var(--font-family-secondary);
  color: var(--color-shade3);
  padding: var(--step--2) var(--step--1);
  border: 1px solid currentcolor;
  margin: 4px;
}
input[type="radio"]:checked + .radio-label {
  color: var(--color-light);
  background: var(--color-shade1);
}
.stepper-controls nav {
  color: var(--color-shade3);
  padding: 0;
  margin: 0 0.5em;
  border-radius: 50%;
  width: var(--step-2);
  height: var(--step-2);
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
  cursor: pointer;
}

.stepper-controls nav span {
  width: var(--step-1);
}

.stepper-controls nav svg {
  -webkit-filter: drop-shadow(0px 0px 2px rgba(0,0,0,0.5)) drop-shadow(0px 0px 8px rgba(0,0,0,0.2));
  filter: drop-shadow(0px 0px 2px rgba(0,0,0,0.5)) drop-shadow(0px 0px 8px rgba(0,0,0,0.2));
}

</style>

{% set variant_title = "Please choose" %}
{% for category in shop_categories %}
  {% if category.name == product.category %}
    {% set variant_title = category.variant %}
  {% endif %}
{% endfor %}

<section id="shop" class="two-column-section">
  <div class="wrapper page-wrapper two-columns" style="--align:start">
    <div class="wrapper image-wrapper flow" style="width:100%">
      <figure class="frame frame1x1 round shadow {{ 'fader' if product_images_count > 1 }}" style="width:100%;background-image:url({{ lqip_data }})">
        {% for product_image in product.images %}
          {% set anim_delay = (anim_fade_time + anim_show_time) * loop.index0 %}
          {% set image_id = (product_image | stripVersion) or (site.header_image | stripVersion) %}
          {% set image_info = image_id | imgInfo %}
          {% set transforms = "c_fill,ar_1,q_auto,f_auto,g_auto/" %}
          {% set src = site.cloudinary_url + "/w_750," + transforms + image_id %}
          <noscript><img class="round" src="{{ src }}" alt="{{ image_info.context.alt or site.alt }}" style="{{ ('animation-delay:' + anim_delay + 's;animation-name:' + (product.name | slug) + '-fade;animation-duration:' + anim_duration + 's') | safe if product_images_count > 1 }}" loading="lazy" decoding="async" /></noscript>
          <div><img class="round" data-srcset="
          {%- for size in image_sizes -%}
          {{ site.cloudinary_url }}/w_{{ size }},{{ transforms }}{{ image_id }} {{ size }}w{{ ',' if not loop.last }}
          {%- endfor -%}
          {%- set sizes = '(min-width: 1500px) and (orientation: landscape) 750px, (min-width: 950px) and (orientation: landscape) 50vw, (min-width: 750px) 750px, 100vw' -%}
          " sizes="{{ sizes }}" data-src="{{ src }}" src="{{ site.transgif }}" alt="{{ image_info.context.alt or site.alt }}" style="{{ ('animation-delay:' + anim_delay + 's;animation-name:' + (product.name | slug) + '-fade;animation-duration:' + anim_duration + 's') | safe if product_images_count > 1 }}" loading="lazy" decoding="async" /></div>
        {% endfor %}
      </figure>
      <p class="font-size--1">{{ product.page_description | safe }}</p>
    </div>
    <div class="wrapper text-wrapper" style="width:100%;height:100%">
      <form id="add-to-cart-form" class="stack" action="/php/add-to-cart.php" method="post" style="height:100%">
        <hr />
        {% set valid_variants = product.variants | validProductVariants %}
        {% if valid_variants | length %}
          <h3 class="heading text-center">{{ variant_title }}</h3>
          <p></p>
          <div class="radio-label-wrapper">
            {% for variant in valid_variants %}
              <input id="{{ variant.id }}" class="visually-hidden" name="variant_id" type="radio" value="{{ variant.id }}" {{ 'checked' if loop.first }}>
              <label class="radio-label text-center round" for="{{ variant.id }}">{{ variant.name }}</label>
            {% endfor %}
          </div>
        {% else %}
          <input id="variant_id" name="variant_id" type="hidden" value="none" style="margin:0">
        {% endif %}

        <h3 class="heading text-center">number of places</h3>
        <div class="stepper-controls" style="display:flex;align-items:center;margin-left:auto;margin-right:auto">
          <nav class="req-js" onclick="document.getElementById('product_count').stepDown();return false;">
            <span role="button" title="Less" aria-label="Less">{{ '/src/svg/minus-circle.svg' | svgContents | safe }}</span>
          </nav>
          <input required id="product_count" name="product_count" type="number" min="1" value="1" class="text-center round" style="width:3em">
          <nav class="req-js" onclick="document.getElementById('product_count').stepUp();return false;">
            <span role="button" title="More" aria-label="More">{{ '/src/svg/plus-circle.svg' | svgContents | safe }}</span>
          </nav>
        </div>

        <input id="product_id" name="product_id" type="hidden" value="{{ product.id }}" style="margin:0">
        <p></p>
        <hr style="margin-top:auto" />
        <div class="bigfonts text-center"><button type="submit">add to cart</button></div>
      </form>
    </div>
  </div>
</section>

{% include "partials/pagination.njk" %}
