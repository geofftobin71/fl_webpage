---
layout: layouts/shop-category.njk
pagination:
  data: shop_categories
  size: 1
  alias: category
  addAllPagesToCollections: true
permalink: "shop/categories/{{ category.name | slug }}/index.html"
eleventyComputed:
  title: "{{ category.name }}"
  description: "{{ category.description }}"
  header_image: "{{ category.image }}"
  header:
    brightness: "{{ category.brightness }}"
  eleventyNavigation:
    key: "{{ category.eleventyNavigation.key }}"
    parent: "{{ category.eleventyNavigation.parent }}"
    order: "{{ category.eleventyNavigation.order }}"
---

<main>
<section class="text-section bg-shade1">
  <article class="wrapper text-wrapper text-center">
    <p>{{ category.description }}</p>
  </article>
</section>

{% set swap = cycler("", "swap") %}
{% for product in shop_products | filterByCategory(category.name) %}
  <section class="two-column-section">
    <div class="wrapper page-wrapper">
      <div class="two-columns {{ swap.next() }}" style="--section-padding:0;--align:center">
        <div class="flow" style="--flow-space:2em">
        </div>
        <div class="flow" style="--flow-space:2em">
          <a href="{{ ( '/shop/products/' + product.name | slug ) | url }}">
            <h3>{{ product.name }}</h3>
            <p>{{ product.description }}</p>
          </a>
        </div>
      </div>
    </div>
  </section>
{% endfor %}

{% set gallery_folder = category.gallery_folder %}
{% if gallery_folder %}
<hr>
<section>
  <div class="wrapper page-wrapper">
    <ul class="auto-grid gallery">

      {% set images = gallery_folder | imgGallery | shuffle %}

      {% for image in images -%}
        {% if image.aspect_ratio > 1.3 %}
          {% set aspect = "4x3" %}
          {% set width = "640" %}
          {% set height = "480" %}
        {% elif image.aspect_ratio > 0.8 %}
          {% set aspect = "1x1" %}
          {% set width = "320" %}
          {% set height = "320" %}
        {% else %}
          {% set aspect = "2x3" %}
          {% set width = "320" %}
          {% set height = "480" %}
        {% endif %}
        <li class="frame frame{{ aspect }} round shadow">
          {% set lqip_path = site.cloudinary_url + "/c_limit,w_32,h_32,q_auto,f_jpg,e_blur:100/" + (image.public_id | stripVersion) %}
          <noscript>
            <a href="{{ site.cloudinary_url }}/c_limit,w_900,h_900,q_auto,f_auto/{{ image.public_id }}" style="height:100%"><img src="{{ site.cloudinary_url }}/c_fill,w_{{ width }},h_{{ height }},q_auto,f_auto,g_auto/{{ image.public_id }}" alt="{{ image.context.alt or site.alt }}" title="{{ image.context.alt or site.alt }}{% if image.context["Credit Name"] %} - Photo credit {{ image.context["Credit Name"] }}{% endif %}" width="{{ width }}" height="{{ height }}" style="background-image:url({{ lqip_path | lqip }});cursor:pointer" loading="lazy" decoding="async" /></a>
          </noscript>
          <img src="{{ site.transgif }}" data-src="{{ site.cloudinary_url }}/c_fill,w_{{ width }},h_{{ height }},q_auto,f_auto,g_auto/{{ image.public_id }}" alt="{{ image.context.alt or site.alt }}" title="{{ image.context.alt or site.alt }}{% if image.context["Credit Name"] %} - Photo credit {{ image.context["Credit Name"] }}{% endif %}" width="{{ width }}" height="{{ height }}" onclick="openLightbox('#item{{ loop.index }}')" style="background-image:url({{ lqip_path | lqip }});cursor:pointer" loading="lazy" decoding="async" />
        </li>
        {%- endfor %}
    </ul>
  </div>
</section>

{# ----- Gallery Lightbox ----- #}

<div id="lightbox" class="slider-controls">
  <ul class="slider">
    {% for image in images -%}
      <li id="item{{ loop.index }}" class="slider-item">
        <figure class="center-both">
          {% set lqip_path = site.cloudinary_url + "/c_limit,w_32,h_32,q_auto,f_jpg,e_blur:100/" + (image.public_id | stripVersion) %}
          <img src="{{ lqip_path | lqip }}" data-srcset="
          {%- for size in image_sizes -%}
          {{ site.cloudinary_url }}/c_limit,w_{{ size }},h_{{ size }},q_auto,f_auto/{{ image.public_id }} {{ size }}w{{ ',' if not loop.last }}
          {%- endfor -%}
          " sizes="{{ "100vh" if image.aspect_ratio < 1 else "100vw" }}" data-src="{{ site.cloudinary_url }}/c_limit,w_900,h_900,q_auto,f_auto/{{ image.public_id }}" alt="{{ image.context.alt or site.alt }}" title="{{ image.context.alt or site.alt }}{% if image.context["Credit Name"] %} - Photo credit {{ image.context["Credit Name"] }}{% endif %}" width="{{ image.width }}" height="{{ image.height }}" loading="lazy" decoding="async" />
          <figcaption class="wrapper text-wrapper">
            <div class="text-center text-shadow flow">
              <h4>{{ image.context.alt or site.alt }}</h4>
              <h5 class="link-light"><a href="{{ site.mailto_obf | safe }}?subject=Gallery%20Enquiry&amp;body=Hi%20Annwyn%0D%0A%0D%0A{{ image.context.alt or site.alt }}%0D%0A{{ site.cloudinary_url }}/c_limit,w_1200,h_1200,q_auto,f_auto/{{ image.public_id }}">Email Floriade about this image</a></h5>
            <h5 class="link-light">{% if image.context["Credit Link"] %}Photo credit <a href="{{ image.context["Credit Link"] | safe }}" target="_blank" rel="noopener">{{ image.context["Credit Name"] }}</a>{% else %}&nbsp;{% endif %}</h5>
            </div>
          </figcaption>
        </figure>
      </li>
      {%- endfor %}
  </ul>
  <nav class="toggle-captions" onclick="toggleCaptions()">
    <span role="button" style="width:var(--step-1)" title="Toggle Captions" aria-label="Toggle Captions">{{ '/src/svg/comment-o.svg' | svgContents | safe }}</span>
  </nav>
  <nav class="close" onclick="closeLightbox()">
    <span role="button" style="width:var(--step-1)" title="Close" aria-label="Close">{{ '/src/svg/close.svg' | svgContents | safe }}</span>
  </nav>
  <nav class="prev" onclick="scrollToPrevItem('#lightbox')">
    <span role="button" style="width:var(--step-1)" title="Previous" aria-label="Previous">{{ '/src/svg/chevron-left.svg' | svgContents | safe }}</span>
  </nav>
  <nav class="next" onclick="scrollToNextItem('#lightbox')">
    <span role="button" style="width:var(--step-1)" title="Next" aria-label="Next">{{ '/src/svg/chevron-right.svg' | svgContents | safe }}</span>
  </nav>
</div>
{% endif %}

{% include "partials/pagination.njk" %}

</main>

