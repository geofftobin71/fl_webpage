---
layout: layouts/shop-page.njk
pagination:
  data: valid_shop_categories
  size: 1
  alias: category
  addAllPagesToCollections: true
permalink: "shop/categories/{{ category.name | slug }}/index.php"
eleventyComputed:
  title: "{{ category.name }}"
  description: "{{ category.description }}"
  header_image: "{{ category.image }}"
  header:
    brightness: "{{ category.brightness }}"
  eleventyNavigation:
    key: "{{ category.eleventyNavigation.key }}"
    parent: "{{ category.eleventyNavigation.parent }}"
    order: "{{ category.eleventyNavigation.order }}"
---
<style>
.products {
  -webkit-width:fit-content;
  -moz-width:fit-content;
  width:fit-content;
  max-width:100%;
  margin:0 auto;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
}
.product {
  width:425px;
  flex:0 0 425px;
}
.product figure {
  width:100%;
  transition:transform 250ms ease;
}
.product:hover figure {
  transform:scale(1.025);
}
.fader img {
  opacity:0;
  animation-iteration-count:infinite;
}
</style>

<main>
<section class="text-section bg-shade1">
  <article class="wrapper text-wrapper text-center">
    <p>{{ category.description }}</p>
  </article>
</section>

<section>
  <div class="wrapper page-wrapper">
    <div class="flow" style="--flow-space:2em">
      {% set product_list = valid_shop_products | filterByCategory(category.name) %}
      {% set product_count = product_list | length %}
      <ul class="products bg-shade1 round shadow" style="margin:0 auto">
        {% for product in product_list %}
          {% set product_images_count = product.images | length %}
          {% set anim_fade_time = 1 %}
          {% set anim_show_time = 4 %}
          {% set anim_duration = (anim_fade_time + anim_show_time) * product_images_count %}
          {% set one_second = 100.0 / anim_duration %}
          {% set product_delay = 0.1 * loop.index0 %}
          <li class="product">
            <a href="{{ ( '/shop/products/' + product.name | slug ) | url }}">
              <div class="stack center text-center" style="padding:var(--step--1)">
                {{ ( '<style>@keyframes ' + (product.name | slug) + '-fade{0%{opacity:0;}' + (anim_fade_time * one_second) + '%{opacity:1;}' + ((anim_fade_time + anim_show_time) * one_second) + '%{opacity:1;}' + ((anim_fade_time + anim_show_time + anim_fade_time) * one_second) + '%{opacity:0;}100%{opacity:0;}}</style>' ) | safe if product_images_count > 1 }}
                {% set image_id = (product.images | first | stripVersion) or (site.header_image | stripVersion) %}
                {% set lqip_path = site.cloudinary_url + "/c_limit,w_32,h_32,q_auto,f_jpg,e_blur:100/" + image_id %}
                {% set lqip_data = lqip_path | imgLqip %}
                <figure class="frame frame1x1 round shadow {{ 'fader' if product_images_count > 1 }}" style="background-image:url({{ lqip_data }})">
                  {% for product_image in product.images %}
                    {% set anim_delay = (anim_fade_time + anim_show_time) * loop.index0 %}
                    {% set image_id = (product_image | stripVersion) or (site.header_image | stripVersion) %}
                    {% set image_info = image_id | imgInfo %}
                    {% set transforms = "c_fill,ar_1,q_auto,f_auto,g_auto/" %}
                    {% set src = site.cloudinary_url + "/w_640," + transforms + image_id %}
                    <noscript><img class="round" src="{{ src }}" alt="{{ image_info.context.alt or site.alt }}" style="{{ ('animation-delay:' + (product_delay + anim_delay) + 's;animation-name:' + (product.name | slug) + '-fade;animation-duration:' + anim_duration + 's') | safe if product_images_count > 1 }}" loading="lazy" decoding="async" /></noscript>
                    <div><img class="round" data-src="{{ src }}" src="{{ site.transgif }}" alt="{{ image_info.context.alt or site.alt }}" style="{{ ('animation-delay:' + (product_delay + anim_delay) + 's;animation-name:' + (product.name | slug) + '-fade;animation-duration:' + anim_duration + 's') | safe if product_images_count > 1 }}" loading="lazy" decoding="async" /></div>
                  {% endfor %}
                </figure>
                <h3 class="text-lowercase">{{ product.name }}</h3>
                <div class="bigfonts font-secondary">
                  {% if product.variants | length %}
                    {% if ( product.variants | first ).price != ( product.variants | last ).price %}
                      <p>{{ 'from ' + product.variants[0].price | formatMoney }}</p>
                    {% else %}
                      <p>{{ product.price | formatMoney }}</p>
                    {% endif %}
                  {% else %}
                    <p>{{ product.price | formatMoney }}</p>
                  {% endif %}
                </div>
              </div>
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</section>

{% set gallery_name = category.name %}
{% set gallery_folder = category.gallery_folder %}
{% include "partials/gallery-section.njk" %}

{% include "partials/pagination.njk" %}

</main>

